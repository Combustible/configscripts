export CONFIG_SCRIPTS_DIR="$(readlink -f "$(dirname "$(readlink -f "$HOME/.zshrc")")/..")"

export PATH="$CONFIG_SCRIPTS_DIR/bin/git-compile/bin:$PATH"
export PATH="$CONFIG_SCRIPTS_DIR/bin/cscope-compile/bin:$PATH"
export PATH="$CONFIG_SCRIPTS_DIR/bin/vim-compile/bin:$PATH"
export PATH="$CONFIG_SCRIPTS_DIR/bin/gdb-compile/bin:$PATH"
export PATH="$CONFIG_SCRIPTS_DIR/bin:$PATH"
export PATH="$HOME/bin:$PATH"

if [[ -d "$CONFIG_SCRIPTS_DIR/bin/python3" ]]; then
	export PATH="$CONFIG_SCRIPTS_DIR/bin/python3/bin:$PATH"
fi
if [[ -d "$CONFIG_SCRIPTS_DIR/bin/python2" ]]; then
	export PATH="$CONFIG_SCRIPTS_DIR/bin/python2/bin:$PATH"
	if [[ "$LD_LIBRARY_PATH " == " " ]]; then
		export LD_LIBRARY_PATH="$CONFIG_SCRIPTS_DIR/bin/python2/lib"
	else
		export LD_LIBRARY_PATH="$CONFIG_SCRIPTS_DIR/bin/python2/lib:$LD_LIBRARY_PATH"
	fi
fi

# No more awful control-s freeze
stty ixany
stty ixoff -ixon

# No more vi for you
alias vi=vim

# Launches vim with a Pyclewn GDB debugging session. Arguments are the program to launch
vimdebug() (
	vim -c "Pyclewn gdb --args $@" -c "Cmapkeys" -c "Cstart"
)

# Strips trailing whitespace errors from the files specified as arguments
fixwhitespace() {
	for file in "$@"; do
		sed -i -e's|[ \t]*\([\r\n]*\)$|\1|g' "$file"
	done
}

# Builds a single cscope database in the current directory to index the files/directories provided as arguments.
# Probably the most common invocation is 'buildcscope .' to index the current directory and subdirectories.
buildcscope() (
	rm -f cscope.in.out cscope.po.out cscope.files cscope.out
	find "$@" -name "*.c" -o -name "*.h" -o -name "*.cpp" | while read line; do
		filename="$(readlink -f "$line")"
		if $(which unifdef > /dev/null); then
			mv -f "$filename" "${filename}_CSCOPETEMP" >&2
			unifdef -b "${filename}_CSCOPETEMP" -U__cplusplus > "$filename"
		fi
		echo $(readlink -f $line)
	done > cscope.files && cscope -b -q -k

	if $(which unifdef > /dev/null); then
		find "$@" -name "*_CSCOPETEMP" | while read line; do
			filename="$(readlink -f "$line")"
			origfilename="$(echo "$filename" | sed 's|_CSCOPETEMP$||g' )";
			mv -f "$filename" "$origfilename"
		done
	fi
)
